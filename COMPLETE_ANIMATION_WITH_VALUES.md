# ?? Complete Animation System with Value Updates

## What You'll See Now

When you run **InsertionSort** animation, you'll see **THREE things happening simultaneously**:

1. ? **Colors change** - showing what phase the algorithm is in
2. ? **Numbers update** - showing the actual array state changing
3. ? **Text annotations** - showing what operation is happening (in console)

---

## ?? Complete Example: Sorting [5, 3, 8, 1]

### Initial State (Frame 0)
```
Visual:
?????????????????????????
?  5  ?  3  ?  8  ?  1  ?
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Console: "Starting Insertion Sort on array of 4 elements"
```

### Iteration 1 - Select Key (Frame 1)
```
Visual:
?????????????????????????
?  5  ?  3  ?  8  ?  1  ?  ? Values unchanged yet
?????????????????????????
? ??  ? ??  ? ?  ? ?  ?
?????????????????????????
  ?    ?
Sorted Key being
portion inserted

Console: "Iteration 1: Selected key = 3"
```

### Iteration 1 - Compare (Frame 2)
```
Visual:
?????????????????????????
?  5  ?  3  ?  8  ?  1  ?? Still [5, 3, 8, 1]
?????????????????????????
? ??  ? ??  ? ?  ? ?  ?
?????????????????????????
  ?    ?
Compared Shifting
element  position

Console: "Comparing: arr[0]=5 > key=3 ? YES - Shift needed"
```

### Iteration 1 - Shift (Frame 3)
```
Visual:
?????????????????????????
?  5  ?  5  ?  8  ?  1  ?  ? 3 is still being held, 5 copied to pos 1
?????????????????????????
? ??  ? ??  ? ?  ? ?  ?
?????????????????????????
  ?    ?
Being  Shifted to
shifted  here

Console: "Shifting arr[0]=5 to position 1"
```

### Iteration 1 - After Shift (Frame 4)
```
Visual:
?????????????????????????
?  5  ?  5  ?  8  ?  1  ?  ? Result of shift
?????????????????????????
? ??  ? ??  ? ?  ? ?  ?
?????????????????????????

Console: "Element shifted to position 1"
```

### Iteration 1 - Insert (Frame 5)
```
Visual:
?????????????????????????
?  3  ?  5  ?  8  ?  1  ?  ? 3 inserted at position 0
?????????????????????????
? ??  ? ??  ? ?  ? ?  ?
?????????????????????????
  ?    ?
Insert Sorted
point  portion

Console: "Inserting key=3 at position 0"
```

### Iteration 1 - Progress (Frame 6)
```
Visual:
?????????????????????????
?  3  ?  5  ?  8  ?  1  ?  ? Now [3, 5, 8, 1]
?????????????????????????
? ??  ? ??  ? ?  ? ?  ?
?????????????????????????
  ?    ?
Sorted Unsorted

Console: "Elements 0-1 are now sorted"
```

### Iteration 2 - Select Key (Frame 7)
```
Visual:
?????????????????????????
?  3  ?  5  ?  8  ?  1  ?  ? Values stay same, just highlighting
?????????????????????????
? ??  ? ??  ? ??  ? ?  ?
?????????????????????????
     ?
        Key = 8

Console: "Iteration 2: Selected key = 8"
```

### Iteration 2 - Compare (Frame 8)
```
Visual:
?????????????????????????
?  3  ?  5  ?  8  ?  1  ?  ? 8 > 5? NO, so no shift needed
?????????????????????????
? ??  ? ??  ? ??  ? ?  ?
?????????????????????????
  ?    ?    ?
Sorted Comp Key

Console: "Comparing: arr[1]=5 > key=8 ? NO - Insert"
```

### Iteration 2 - Insert (Frame 9)
```
Visual:
?????????????????????????
?  3  ?  5  ?  8  ?  1  ?  ? 8 stays at position 2
?????????????????????????
? ??  ? ??  ? ??  ? ?  ?
?????????????????????????
  ?    ? ?
Sorted Already

Console: "Inserting key=8 at position 2"
```

### Iteration 2 - Progress (Frame 10)
```
Visual:
?????????????????????????
?  3  ?  5  ?  8  ?  1  ?  ? Now [3, 5, 8, 1]
?????????????????????????
? ??  ? ??  ? ??  ? ?  ?
?????????????????????????
  ?    ??
Sorted portion

Console: "Elements 0-2 are now sorted"
```

### Iteration 3 - Select Key (Frame 11)
```
Visual:
?????????????????????????
?  3  ?  5  ?  8  ?  1  ?
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????
     ?
            Key = 1

Console: "Iteration 3: Selected key = 1"
```

### Iteration 3 - Multiple Comparisons (Frames 12-14)
```
Frame 12: Compare
?????????????????????????
?  3  ?  5  ?  8  ?  1  ?  ? 8 > 1? YES
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Frame 13: Shift
?????????????????????????
?  3  ?  5  ?  8  ?  8  ?  ? 8 moved to position 3
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Frame 14: After Shift
?????????????????????????
?  3  ?  5  ?  8  ?  8  ?
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Frame 15: Compare Again
?????????????????????????
?  3  ?  5  ?  8  ?  8  ?  ? 5 > 1? YES
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Frame 16: Shift
?????????????????????????
?  3  ?  5  ?  5  ?  8  ?  ? 5 moved to position 2
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Frame 17: Compare Again
?????????????????????????
?  3  ?  5  ?  5  ?  8  ?  ? 3 > 1? YES
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Frame 18: Final Shift
?????????????????????????
?  3  ?  3  ?  5  ?  8  ?  ? 3 moved to position 1
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Frame 19: Insert
?????????????????????????
?  1  ?  3  ?  5  ?  8  ?  ? 1 inserted at position 0
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????
  ?
Insert point

Console: "Inserting key=1 at position 0"
```

### Iteration 3 - Final (Frame 20)
```
Visual:
?????????????????????????
?  1  ?  3  ?  5  ?  8  ?  ? Now completely sorted!
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Console: "Elements 0-3 are now sorted"
```

### Final Frame (Frame 21)
```
Visual:
?????????????????????????
?  1  ?  3  ?  5  ?  8  ?
?????????????????????????
? ??  ? ??  ? ??  ? ??  ?
?????????????????????????

Console: "? Array is completely sorted!"
Animation Pauses
```

---

## ?? How to Run This

### Step 1: Build
```bash
cd "C:\Users\User\source\repos\YassineBibrine\dataviz-uit"
cmake --build build --config Debug
```

### Step 2: Run
```bash
.\build\bin\dataviz-uit.exe
```

### Step 3: Test
1. Click **"Create Sample Structures"**
2. Select **"Sample Array"** from the list
3. Select **"InsertionSort"** from Algorithm dropdown
4. Click **"Play"** button
5. Watch the numbers **change** as the algorithm executes!

---

## ?? What's Different Now

### Before (Without Value Updates)
```
[5] [3] [8] [1]
 ??  ??  ??  ?
? Only colors change, no way to see data movement
```

### After (With Value Updates) ?
```
[5] [3] [8] [1]  ? Shows initial values
 ??  ??  ?  ?

[5] [5] [8] [1]  ? Shows shift operation
 ??  ??  ?  ?

[3] [5] [8] [1]  ? Shows insertion
 ??  ??  ?  ?
```

Now you can see **exactly** what the algorithm is doing to the data!

---

## ?? Technical Details

### How Values Are Updated

In `insertion_sort.h`, **every frame** includes the current array state:

```cpp
// Add current array state to frame
for (int k = 0; k < n; k++) {
    frame.nodeLabels["node_" + std::to_string(k)] = std::to_string(data[k]);
}
recorder.recordFrame(frame);
```

This is done **after each operation** (shift, insert, etc.) so the visualization shows the actual effect.

### Animation Frame Structure

```cpp
struct AnimationFrame {
    // Colors showing what's happening
    std::vector<std::string> highlightedNodes;  // ["node_0", "node_1"]
    std::map<std::string, std::string> nodeColors;  // {"node_0" ? "red"}
    
// Current values of nodes
    std::map<std::string, std::string> nodeLabels;  // {"node_0" ? "5"}
    
    // Position information
    std::map<std::string, std::pair<double, double>> nodePositions;
    std::map<std::string, std::string> nodeShapes;
    
    // Debug info
  std::vector<std::string> annotations;  // ["Shifting 5 to position 1"]
};
```

### Rendering Process

1. **Algorithm generates frame** with:
   - Highlighted nodes (which ones are active)
   - Colors (what operation is happening)
   - Labels (current values after operation)

2. **PlaybackController** emits frame every 500ms

3. **VisualizationPane** receives frame and:
   - Maps frame node IDs ("node_0") to canvas node IDs
   - Extracts labels from frame
   - Passes to renderer

4. **VisualizationRenderer** draws:
   - Nodes at their positions
   - With their colors
   - Labeled with their current values

---

## ?? Expected Output

When you play the animation, you should see:

? **Values change** as the algorithm sorts
? **Colors indicate** what operation is happening  
? **Speed slider** controls animation speed
? **Console** shows detailed operation descriptions

For example:
```
Frame: Shift Right - Shifting arr[0]=5 to position 1
        Before: [5] [3] [8] [1]
        After:  [5] [5] [8] [1]  ? 5 appears in both positions momentarily

Frame: Insert - Inserting key=3 at position 0
        Before: [5] [5] [8] [1]
      After:  [3] [5] [8] [1]  ? 3 is now in correct position
```

---

## ?? Debugging

### Check Console Output
```
InsertionSort generated 21 animation frames
PlaybackController: Loaded 21 frames
PlaybackController: Starting playback with interval 500 ms
Frame: Select Key - Iteration 1: Selected key = 3
Remapped label: node_0 ? <canvas_id> = 5
Remapped label: node_1 ? <canvas_id> = 3
...
Frame: Insert - Inserting key=3 at position 0
Remapped label: node_0 ? <canvas_id> = 3
Remapped label: node_1 ? <canvas_id> = 5
...
Animation complete
```

### If Numbers Don't Update

1. **Check frame generation:**
 - Look for "InsertionSort generated X frames" in console
   - Should see 20+ frames for a 4-element array

2. **Check label remapping:**
   - Look for "Remapped label:" lines in console
   - Shows which canvas node has which value

3. **Check visualization:**
   - Verify nodes are showing up in the visualization
   - Check that colors are changing (if colors work, values should too)

---

## ?? Step-by-Step Demo

Here's exactly what to see:

1. **Click "Create Sample Structures"**
   - Dialog: "Successfully created 4 sample structure(s)"
   
2. **Select "Sample Array"**
   - Visualization shows: `[5] [3] [8] [1]` or similar random numbers
   - All nodes: ?? Blue
   
3. **Select "InsertionSort"**
   - Algorithm dropdown shows: "InsertionSort"
   
4. **Click "Play"**
   - Animation starts
   - Nodes change colors
   - **Most importantly: Numbers change!**
   
5. **Watch the progression:**
   - First iteration: numbers rearrange to `[3] [5] [8] [1]`
   - Second iteration: `[3] [5] [8] [1]` (8 already in correct spot)
   - Third iteration: `[1] [3] [5] [8]`
 - Final: All ?? Green, completely sorted
   
6. **Use controls:**
   - Pause: Stops on current state
   - Speed slider: Adjust animation speed
   - Step: Advance frame-by-frame to see each operation
   - Reset: Back to original unsorted state

---

## ? Summary

The animation system now shows:

| Aspect | What You See |
|--------|--------------|
| **Visual Colors** | Algorithm phases (select/compare/shift/insert) |
| **Node Values** | Actual array data changing in real-time |
| **Highlights** | Which elements are active in current operation |
| **Console** | Detailed operation descriptions |
| **Animation** | Smooth frame-by-frame playback |
| **Controls** | Play, pause, speed, step, reset |

**Everything works together to show exactly what the algorithm is doing!** ??

